<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Player with Play Counter</title>
    <style>
        .video-container { max-width: 600px; margin: 20px auto; text-align: center; font-family: sans-serif; }
        video { width: 100%; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .play-btn { margin-top: 15px; padding: 10px 25px; font-size: 16px; cursor: pointer; background: #039be5; color: white; border: none; border-radius: 4px; }
        .play-btn:hover { background: #0277bd; }
        #playCount { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="video-container">
    <h2 id="videoTitle">My Amazing Video</h2>
    <!-- Poster is your thumbnail image -->
    <video id="myVideo" poster="https://via.placeholder.com">
        <source src="your-video-url.mp4" type="video/mp4">
    </video>
    <br>
    <button class="play-btn" id="playBtn">â–¶ Play Video</button>
    <p id="playCount">Plays: 0</p>
</div>

<!-- Firebase SDK Integration -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com";
  import { getFirestore, doc, updateDoc, increment, onSnapshot } from "https://www.gstatic.com";

  // TODO: Replace with YOUR project's config from Firebase Console
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Reference to your specific video document in Firestore
  // Collection: "videos", Document ID: "video1" (Must exist in your DB)
  const videoRef = doc(db, "videos", "video1");

  const videoElement = document.getElementById('myVideo');
  const playBtn = document.getElementById('playBtn');
  const countDisplay = document.getElementById('playCount');

  // 1. Listen for live updates to the play count
  onSnapshot(videoRef, (snapshot) => {
    if (snapshot.exists()) {
      countDisplay.innerText = `Plays: ${snapshot.data().plays || 0}`;
    }
  });

  // 2. Play video and Increment play field in Firebase
  playBtn.addEventListener('click', async () => {
    try {
      videoElement.play();
      // Atomic increment by 1
      await updateDoc(videoRef, {
        plays: increment(1)
      });
      console.log("Play count updated successfully!");
    } catch (error) {
      console.error("Error updating play count:", error);
    }
  });
</script>

</body>
</html>
