<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
body { background-color: #0b1d61; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; color: #fff; }
form { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; background:#0d1b2a; padding:35px 25px; border-radius:12px; box-shadow:0 15px 35px rgba(0,0,0,0.7);}
h1 { text-align: center; font-size: 28px; margin-bottom: 20px; color: #00aaff; }
input { padding: 12px 15px; border-radius: 8px; border: none; font-size: 16px; width: 100%; outline: none; transition: all 0.3s ease; color: #0b1d61; text-align:center;}
input::placeholder { color: #0b1d61; text-align:center; }
input:focus { box-shadow: 0 0 10px rgba(255,255,255,0.5); }
button { padding: 14px; border-radius: 8px; border: none; font-size: 16px; cursor: pointer; background: #1a2b8f; color: #fff; transition: background 0.3s ease, transform 0.2s ease; }
button:hover { background: #2a3bb5; transform: scale(1.03); }
a { text-align: center; display: block; font-size: 14px; color: #9ec1ff; text-decoration: none; margin-top: 10px; }
a:hover { text-decoration: underline; }
.error-msg{ color:#ff4c4c; text-align:center; font-size:14px; margin-bottom:5px;}
@media (max-width:480px){ input,button{ font-size:15px; padding:12px 15px; } h1{ font-size:24px; } }
</style>
</head>
<body>

<form id="loginForm">
  <h1>Login</h1>
  <div id="error" class="error-msg"></div>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <button type="submit">Login</button>
  <a href="signup.html">Don't have an account? Sign Up</a>
</form>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL = 'https://dmoktpmrrsrjjspipddd.supabase.co';
const SUPABASE_KEY = 'sb_publishable_04Ks9PDsOCUAfT3A_K-Mtg_LBPTNOGS';
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

const loginForm = document.getElementById('loginForm');
const passwordInput = document.getElementById('password');
const errorDiv = document.getElementById('error');

loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  errorDiv.textContent='';

  const email = document.getElementById('email').value;
  const password = passwordInput.value;

  try {
    const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({ email, password });
    if(loginError) throw loginError;

    // Check if user exists in Users table
    const { data: userData, error: userError } = await supabase.from('Users').select('*').eq('id', loginData.user.id).single();
    if(userError) throw new Error('User data not found. Please signup first.');

    // Successful login â†’ redirect
    alert(`Welcome back, ${userData.name || 'User'}!`);
    window.location.href='dashboard.html'; // redirect to dashboard
  } catch(err){
    errorDiv.textContent = err.message;
  }
});
</script>

</body>
</html>