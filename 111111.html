<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Page - JEETO</title>
  <style>
    /* ====== General Styles ====== */
    body { margin:0; font-family: Arial, sans-serif; background-color:#0d1b2a; color:#fff; }
    header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background-color:#1b2a4d; box-shadow:0 4px 8px rgba(0,0,0,0.3); }
    header .logo { font-weight:bold; font-size:24px; color:#ffdd57; }
    header .profile-icons img { width:36px; height:36px; margin-left:15px; cursor:pointer; border-radius:50%; transition:transform 0.3s; }
    header .profile-icons img:hover { transform:scale(1.2); }
    .container { padding:20px; }
    .game-header { display:flex; flex-direction:column; align-items:center; margin-bottom:20px; }
    .game-header img { width:100%; max-width:600px; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); margin-bottom:15px; }
    .game-header h1 { font-size:32px; color:#ffdd57; margin-bottom:15px; text-align:center; }
    .play-btn { padding:12px 30px; font-size:18px; background-color:#ffdd57; color:#0d1b2a; border:none; border-radius:10px; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .play-btn:hover { transform:scale(1.05); box-shadow:0 6px 12px rgba(0,0,0,0.3); }
    .stats { display:flex; justify-content:space-around; margin-top:20px; margin-bottom:30px; font-size:18px; background-color:#1b2a4d; padding:15px; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); }
    .stats div { text-align:center; }
    .rules { background-color:#1b2a4d; color:#ffdd57; padding:20px; margin-bottom:20px; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); }
    .rules h2 { margin-top:0; font-size:28px; text-align:center; }
    .rules ul { line-height:1.8; font-size:18px; padding-left:20px; }
    .back-btn { display:block; margin:20px auto; padding:12px 30px; font-size:18px; background-color:#ffdd57; color:#0d1b2a; border:none; border-radius:10px; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; text-decoration:none; text-align:center; }
    .back-btn:hover { transform:scale(1.05); box-shadow:0 6px 12px rgba(0,0,0,0.3); }
    @media(max-width:600px){ .stats { flex-direction:column; } }

    /* Loading spinner */
    #loading {
      position: fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(13,27,42,0.95);
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      font-size:24px; color:#ffdd57; z-index:9999;
      transition: opacity 0.3s ease;
    }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #ffdd57;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    #loading.hidden { opacity:0; pointer-events:none; }
  </style>
</head>
<body>

  <!-- Loading Spinner -->
  <div id="loading">
    <div class="spinner"></div>
    <div style="margin-top:10px;">Loading...</div>
  </div>

  <!-- Header -->
  <header>
    <div class="logo">JEETO</div>
    <div class="profile-icons">
      <a href="#"><img src="https://via.placeholder.com/36" alt="Profile 1"></a>
      <a href="#"><img src="https://via.placeholder.com/36" alt="Profile 2"></a>
    </div>
  </header>

<div class="container">
  <!-- Game Header -->
  <div class="game-header">
    <!-- Thumbnail from JSON -->
    <img src="https://playgama.com/cdn-cgi/imagedelivery/LN2S-4p3-GgZvEx3IPaKUA/06ce1e86-e24c-466e-4fbb-cb4ebc2b5200/enlarged" 
         alt="Hidden Object: Clues and Mysteries">
    
    <!-- Title from JSON -->
    <h1>Hidden Object: Clues and Mysteries</h1>
    
    <!-- Play button → open iframe in same page / modal -->
    <button class="play-btn" onclick="openGame()">Play Now</button>
  </div>
</div>

<!-- Container for iframe (hidden by default) -->
<div id="gameIframeContainer" style="display:none; text-align:center; margin-top:20px;">
  <iframe id="gameIframe" 
          src="https://playgama.com/export/game/hidden-object-clues-and-mysteries?clid=p_dcac1d62-2343-4dd3-b9f1-84b78b60da33" 
          allow="fullscreen; accelerometer; camera; clipboard-read; clipboard-write; screen-wake-lock; speaker-selection; web-share; geolocation; gyroscope; microphone; xr-spatial-tracking; autoplay; encrypted-media; picture-in-picture; payment; publickey-credentials-get; publickey-credentials-create; storage-access; attribution-reporting; browsing-topics" 
          frameborder="0" width="800" height="450">
  </iframe>
</div>

<script>
  // Show iframe on Play button click
  function openGame() {
    document.getElementById("gameIframeContainer").style.display = "block";
    // Scroll to iframe smoothly
    document.getElementById("gameIframeContainer").scrollIntoView({ behavior: 'smooth' });
  }
</script>

    <!-- Stats -->
    <div class="stats">
      <div>
        <strong>Played Time:</strong> <span id="played-time">1s</span>
      </div>
      <div>
        <strong>Total Plays:</strong> <span id="total-plays">0</span>
      </div>
    </div>

    <!-- Rules Section -->
    <div class="rules">
      <h2>How to Play and Earn / آپ کیسے کمائیں گے</h2>
      <ul>
        <li>Click any game you want to play. <br> کسی بھی گیم پر کلک کریں جو آپ کھیلنا چاہتے ہیں۔</li>
        <li>Play for at least 30 seconds — your plays will be counted. <br> کم از کم 30 سیکنڈ کھیلیں — آپ کے پلے گنے جائیں گے۔</li>
        <li>The more you play, the more you earn. <br> جتنا زیادہ کھیلیں گے، اتنا زیادہ کمائیں گے۔</li>
        <li>Spend more time on a single game — earn through minutes! <br> کسی ایک گیم پر زیادہ وقت گزاریں — منٹ کے حساب سے کمائیں!</li>
      </ul>
    </div>

    <!-- Back Button -->
    <a href="index.html" class="back-btn">← Back to Games</a>
  </div>

  <!-- Firebase + Auth + Game Tracking -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBe3E2eSUaDH5rZHguezaHjbxKmRA5QVd4",
      authDomain: "rewards-b8f54.firebaseapp.com",
      projectId: "rewards-b8f54",
      storageBucket: "rewards-b8f54.appspot.com",
      messagingSenderId: "588528777945",
      appId: "1:588528777945:web:6dc9600f1f230e3813dcc8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userId, playedTime = 0, timer, totalPlays = 0;
    const playedTimeEl = document.getElementById('played-time');
    const totalPlaysEl = document.getElementById('total-plays');
    const loadingEl = document.getElementById('loading');

    // Prevent back navigation
    window.history.pushState(null,"",location.href);
    window.onpopstate = () => window.history.pushState(null,"",location.href);

    // Auth + User Doc Check
    onAuthStateChanged(auth, async user => {
      if(!user) return location.replace("index.html");
      userId = user.uid;

      const userRef = doc(db,"users",userId);
      const snap = await getDoc(userRef);
      if(!snap.exists()) return location.replace("index.html");

      const data = snap.data();
      if(data.account === "pending") return location.replace("approve.html");
      if(data.account !== "approved") return location.replace("index.html");

      // Auth validated → hide spinner
      loadingEl.classList.add('hidden');

      // Populate stats if available
      playedTimeEl.textContent = data.timespent || "0s";
      totalPlaysEl.textContent = data.plays || 0;
    });

    // Start game → track plays + time
    window.startGame = async function() {
      if(!userId) return;

      totalPlays++;
      totalPlaysEl.textContent = totalPlays;
      const userRef = doc(db,"users",userId);

      await updateDoc(userRef,{ plays: increment(1) });

      // Timer reset
      clearInterval(timer);
      playedTime = 0;
      playedTimeEl.textContent = playedTime + "s";

      timer = setInterval(async () => {
        playedTime++;
        playedTimeEl.textContent = playedTime + "s";
        if(playedTime % 5 === 0){
          await updateDoc(userRef,{ timespent: increment(5) });
        }
      },1000);
    }

    // Save remaining time if user leaves
    window.addEventListener('beforeunload', async () => {
      if(userId && playedTime>0){
        const userRef = doc(db,"users",userId);
        await updateDoc(userRef,{ timespent: increment(playedTime) });
      }
    });
  </script>
</body>
</html>