<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
body{background:linear-gradient(135deg,#0b1d61,#08123a);color:#fff;min-height:100vh;display:flex;flex-direction:column;}

/* Header */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 25px;
  background: #0a184f;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-left .logo { width:50px; height:50px; border-radius:50%; object-fit:cover; border:2px solid #00aaff; }
.header-right { display:flex; align-items:center; gap:10px; }
.header-right .user-profile {
  width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center;
  border:2px solid #00aaff; cursor:pointer; background:#1a2b8f; font-size:22px; color:#fff; transition:.3s;
}
.header-right .user-profile:hover{ transform: scale(1.1); box-shadow:0 0 15px #00aaff80; }
.membership-badge { background: gold; color:#000; font-weight:bold; padding:4px 10px; border-radius:12px; font-size:13px; display:flex; align-items:center; gap:4px; }

/* Profile container */
.profile-container{
  max-width:700px; margin:30px auto; padding:0 15px; display:flex; flex-direction:column; gap:15px;
}

/* Info card */
.info-card{
  background:linear-gradient(135deg,#1a2b8f,#243bba);
  padding:20px 25px;
  border-radius:18px;
  box-shadow:0 15px 30px rgba(0,0,0,.35);
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:17px;
  font-weight:600;
  transition:.25s;
}
.info-card:hover{ transform: translateY(-3px); box-shadow:0 25px 45px rgba(0,0,0,.5);}
.info-card span{font-size:13px; opacity:.8; display:block;}
.info-card strong{font-size:18px; color:#fff;}

/* Progress bar for Level */
.progress-bar{
  width:50%; height:12px; background:rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; margin-top:6px;
}
.progress{
  height:12px; background:#00aaff; width:0%; border-radius:8px; transition:width 1s;
}

/* Logout button */
.logout-btn{
  margin:25px auto; display:block; background:#ff4c4c; color:#fff; border:none;
  padding:14px 28px; border-radius:12px; font-size:16px; cursor:pointer; font-weight:bold; transition:.25s;
}
.logout-btn:hover{ background:#ff6666; }

/* Footer */
footer{
  text-align:center; padding:15px 0; margin-top:auto;
  background:#0a184f; box-shadow:0 -4px 12px rgba(0,0,0,0.4); font-size:14px; color:#00e0ff;
}

/* Spinner */
#loading { position:fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#08123a; z-index:999; }
.spinner { border:5px solid rgba(255,255,255,0.3); border-top:5px solid #00aaff; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; }
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="logo.png" alt="Logo" class="logo">
  </div>
  <div class="header-right">
    <a href="#" class="user-profile">ðŸ‘¤</a>
    <div class="membership-badge" id="membershipBadge" style="display:none;">ðŸ’Ž VIP</div>
  </div>
</header>

<div id="loading"><div class="spinner"></div></div>

<div class="profile-container" id="profileContainer" style="display:none;">
  <div class="info-card"><div><span>Name</span><strong id="name">-</strong></div></div>
  <div class="info-card"><div><span>Email</span><strong id="email">-</strong></div></div>
  <div class="info-card"><div><span>Total Clicks</span><strong id="totalClicks">0</strong></div></div>
  <div class="info-card"><div><span>Today Clicks</span><strong id="todayClicks">0</strong></div></div>
  <div class="info-card"><div><span>Date Joined</span><strong id="joined">-</strong></div></div>
  <div class="info-card" style="flex-direction:column;align-items:flex-start;">
    <span>Level</span>
    <strong id="userLevel">1</strong>
    <div class="progress-bar">
      <div class="progress" id="levelProgress"></div>
    </div>
    <small id="nextLevelReq" style="color:#00e0ff;margin-top:4px;font-size:12px;"></small>
  </div>
  <div class="info-card"><div><span>Withdrawal</span><strong id="withdraw">$0.00</strong></div></div>
  <div class="info-card"><div><span>Game Played Time</span><strong id="gameTime">0h 0m</strong></div></div>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<footer>JEETO All rights reserved</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBe3E2eSUaDH5rZHguezaHjbxKmRA5QVd4",
  authDomain: "rewards-b8f54.firebaseapp.com",
  projectId: "rewards-b8f54",
  storageBucket: "rewards-b8f54.appspot.com",
  messagingSenderId: "588528777945",
  appId: "1:588528777945:web:6dc9600f1f230e3813dcc8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loading = document.getElementById("loading");
const profileContainer = document.getElementById("profileContainer");
const badge = document.getElementById("membershipBadge");

onAuthStateChanged(auth, async user => {
  if(!user) return location.replace("index.html");

  const userRef = doc(db,"users",user.uid);
  const snap = await getDoc(userRef);
  if(!snap.exists()) return location.replace("index.html");

  const data = snap.data();

  // Fill profile info
  document.getElementById("name").textContent = data.name || "-";
  document.getElementById("email").textContent = data.email || "-";
  document.getElementById("totalClicks").textContent = data.totalClicks || 0;
  document.getElementById("todayClicks").textContent = data.todayClicks || 0;
  document.getElementById("withdraw").textContent = "$" + ((data.withdraw || 0).toFixed(2));
  document.getElementById("gameTime").textContent = data.gameTime || "0h 0m";
  document.getElementById("joined").textContent = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleDateString() : "-";

  // Membership badge
  if(data.membership === "active") badge.style.display = "flex";
  else badge.style.display = "none";

  // Level from levels map in user doc
  const totalClicks = data.all|| 0;
  const levelsMap = data.levels || {}; // user doc should have levels map
  const levelsArr = Object.entries(levelsMap)
    .map(([lvl, req]) => ({ level: lvl.replace("level",""), clicks: req }))
    .sort((a,b)=>a.clicks-b.clicks);

  let currentLevel = 1;
  let currentMin = 0;
  let nextMin = levelsArr[0]?.clicks || 0;

  for(let i=0;i<levelsArr.length;i++){
    if(totalClicks >= levelsArr[i].clicks){
      currentLevel = levelsArr[i].level;
      currentMin = levelsArr[i].clicks;
      nextMin = levelsArr[i+1]?.clicks ?? levelsArr[i].clicks;
    } else break;
  }

  document.getElementById("userLevel").textContent = currentLevel;
  const progressPercent = Math.min(((totalClicks-currentMin)/(nextMin-currentMin))*100,100);
  document.getElementById("levelProgress").style.width = progressPercent + "%";
  document.getElementById("nextLevelReq").textContent = `Clicks to Level ${Number(currentLevel)+1}: ${Math.max(nextMin-totalClicks,0)}`;

  // Show profile container
  loading.style.display = "none";
  profileContainer.style.display = "flex";
});

// Logout
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  location.replace("index.html");
});
</script>
</body>
</html>