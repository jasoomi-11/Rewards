<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Page - JEETO</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#0d1b2a; color:#fff; }
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#1b2a4d; box-shadow:0 4px 8px rgba(0,0,0,0.3); }
  header .logo { font-weight:bold; font-size:24px; color:#ffdd57; }
  .container { padding:20px; max-width:800px; margin:auto; }
  .game-header { display:flex; flex-direction:column; align-items:center; margin-bottom:20px; }
  .game-header img { width:100%; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); margin-bottom:15px; }
  .game-header h1 { font-size:32px; color:#ffdd57; margin-bottom:15px; text-align:center; }
  .play-btn { padding:12px 30px; font-size:18px; background:#ffdd57; color:#0d1b2a; border:none; border-radius:10px; cursor:pointer; transition:0.2s; }
  .play-btn:hover { transform:scale(1.05); box-shadow:0 6px 12px rgba(0,0,0,0.3); }
  .stats { display:flex; justify-content:space-around; margin:20px 0; font-size:18px; background:#1b2a4d; padding:15px; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); }
  .stats div { text-align:center; }
  .rules { background:#1b2a4d; color:#ffdd57; padding:20px; margin-bottom:20px; border-radius:15px; box-shadow:0 8px 15px rgba(0,0,0,0.4); }
  .rules h2 { text-align:center; font-size:28px; margin-top:0; }
  .rules ul { padding-left:20px; line-height:1.8; font-size:18px; }
  .back-btn { display:block; margin:20px auto; padding:12px 30px; font-size:18px; background:#ffdd57; color:#0d1b2a; border:none; border-radius:10px; text-align:center; text-decoration:none; cursor:pointer; transition:0.2s; }
  .back-btn:hover { transform:scale(1.05); box-shadow:0 6px 12px rgba(0,0,0,0.3); }

  /* Loading spinner */
  #loading { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(13,27,42,0.95); display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:24px; color:#ffdd57; z-index:9999; }
  .spinner { border:6px solid #f3f3f3; border-top:6px solid #ffdd57; border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; }
  @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

  /* Fullscreen iframe */
  #iframeContainer { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:1000; justify-content:center; align-items:center; flex-direction:column; }
  #gameIframe { width:100%; height:100%; border:none; }
  #quitBtn { position:absolute; top:20px; right:20px; padding:12px 20px; font-size:18px; border:none; border-radius:10px; background:#ffdd57; color:#0d1b2a; cursor:pointer; z-index:1010; }
</style>
</head>
<body>

<div id="loading">
  <div class="spinner"></div>
  <div style="margin-top:10px;">Loading...</div>
</div>

<header>
  <div class="logo">JEETO</div>
</header>

<div class="container">
  <div class="game-header">
    <img src="https://playgama.com/cdn-cgi/imagedelivery/LN2S-4p3-GgZvEx3IPaKUA/06ce1e86-e24c-466e-4fbb-cb4ebc2b5200/enlarged" alt="Hidden Object: Clues and Mysteries">
    <h1>Hidden Object: Clues and Mysteries</h1>
    <button class="play-btn" id="playBtn">Play Now</button>
  </div>

  <div class="stats">
    <div><strong>Played Time:</strong> <span id="played-time">0s</span></div>
    <div><strong>Total Plays:</strong> <span id="total-plays">0</span></div>
  </div>

  <div class="rules">
    <h2>How to Play and Earn / Ø¢Ù¾ Ú©ÛŒØ³Û’ Ú©Ù…Ø§Ø¦ÛŒÚº Ú¯Û’</h2>
    <ul>
      <li>Click Play Now to start the game. <br> Ù¾Ù„Û’ Ù†Ø§Ø¤ Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚº ØªØ§Ú©Û Ú¯ÛŒÙ… Ø´Ø±ÙˆØ¹ ÛÙˆÛ”</li>
      <li>Play for at least 30 seconds â€” your plays will be counted. <br> Ú©Ù… Ø§Ø² Ú©Ù… 30 Ø³ÛŒÚ©Ù†Úˆ Ú©Ú¾ÛŒÙ„ÛŒÚº â€” Ø¢Ù¾ Ú©Û’ Ù¾Ù„Û’ Ú¯Ù†Û’ Ø¬Ø§Ø¦ÛŒÚº Ú¯Û’Û”</li>
      <li>The more you play, the more you earn. <br> Ø¬ØªÙ†Ø§ Ø²ÛŒØ§Ø¯Û Ú©Ú¾ÛŒÙ„ÛŒÚº Ú¯Û’ØŒ Ø§ØªÙ†Ø§ Ø²ÛŒØ§Ø¯Û Ú©Ù…Ø§Ø¦ÛŒÚº Ú¯Û’Û”</li>
      <li>Spend more time on a single game â€” earn through minutes! <br> Ú©Ø³ÛŒ Ø§ÛŒÚ© Ú¯ÛŒÙ… Ù¾Ø± Ø²ÛŒØ§Ø¯Û ÙˆÙ‚Øª Ú¯Ø²Ø§Ø±ÛŒÚº â€” Ù…Ù†Ù¹ Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ Ú©Ù…Ø§Ø¦ÛŒÚº!</li>
    </ul>
  </div>

  <a href="index.html" class="back-btn">â† Back to Games</a>
</div>

<div id="iframeContainer">
  <button id="quitBtn">â† Back / Quit</button>
  <iframe id="gameIframe" src="https://playgama.com/export/game/hidden-object-clues-and-mysteries?clid=p_dcac1d62-2343-4dd3-b9f1-84b78b60da33" allow="fullscreen; autoplay; encrypted-media; picture-in-picture"></iframe>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getDatabase, ref, runTransaction } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBe3E2eSUaDH5rZHguezaHjbxKmRA5QVd4",
    authDomain: "rewards-b8f54.firebaseapp.com",
    databaseURL: "https://rewards-b8f54-default-rtdb.firebaseio.com",
    projectId: "rewards-b8f54",
    storageBucket: "rewards-b8f54.firebasestorage.app",
    messagingSenderId: "588528777945",
    appId: "1:588528777945:web:6dc9600f1f230e3813dcc8"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const loading = document.getElementById("loading");
  const playBtn = document.getElementById("playBtn");
  const iframeContainer = document.getElementById("iframeContainer");
  const quitBtn = document.getElementById("quitBtn");

  let uid = null;

  // ğŸ”¹ AUTH CHECK
  onAuthStateChanged(auth, (user) => {
    loading.style.display = "none";
    if (user) {
      uid = user.uid;
      console.log("Logged in:", uid);
    } else {
      alert("Please login first");
    }
  });

  // ğŸ”¹ PLAY CLICK
  playBtn.addEventListener("click", () => {
    if (!uid) {
      alert("Login required");
      return;
    }

    iframeContainer.style.display = "flex";

    // ğŸ”¥ GUARANTEED WRITE
    const playsRef = ref(db, `users/${uid}/plays`);

    runTransaction(playsRef, (current) => {
      return (current || 0) + 1;
    });

    console.log("Play stored in Realtime DB");
  });

  quitBtn.addEventListener("click", () => {
    iframeContainer.style.display = "none";
  });
</script>
</body>
</html>