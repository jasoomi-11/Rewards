<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Tasks</title>

<style>
body{
  margin:0;
  font-family:Segoe UI,sans-serif;
  background:linear-gradient(180deg,#0b1d61,#08123a);
  color:#fff;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 20px;
  background:#0a184f;
}
header h2{color:#00aaff;}
header button{
  border:none;
  padding:8px 14px;
  border-radius:8px;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.tasks{
  max-width:900px;
  margin:30px auto;
  padding:0 15px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card{
  background:#1e40af;
  padding:16px;
  border-radius:12px;
  text-align:center;
  box-shadow:0 8px 20px rgba(0,0,0,.4);
}
.card h4{margin:0 0 10px;}
.timer{
  font-size:14px;
  margin-bottom:10px;
  color:#c7d2fe;
}
.card button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#22c55e;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
.card button:disabled{
  background:#94a3b8;
  cursor:not-allowed;
}
.note{
  max-width:900px;
  margin:20px auto;
  padding:15px;
  background:#0f172a;
  border-radius:12px;
  font-size:14px;
  color:#cbd5f5;
}
</style>
</head>

<body>

<header>
  <h2>Redirect Tasks</h2>
  <div>
    <button onclick="location.href='dashboard.html'">Back</button>
    <button onclick="location.href='index.html'">Logout</button>
  </div>
</header>

<div class="tasks" id="tasks"></div>

<div class="note">
‚ö†Ô∏è Note: Click will be enabled after countdown.  
Earnings & clicks will be added only after verification on blog page.
</div>

<script>
const TASKS_JSON = "tasks.json";
const COUNTDOWN_SECONDS = 5;
const BLOG_VERIFY_PAGE = "blog.html";

let currentIndex = 0;

function generateToken(){
  return crypto.randomUUID() + "-" + Date.now();
}

async function loadTasks(){
  const res = await fetch(TASKS_JSON);
  return await res.json();
}

function createCard(task, index){
  const card = document.createElement("div");
  card.className = "card";

  const title = document.createElement("h4");
  title.textContent = task.title;

  const timer = document.createElement("div");
  timer.className = "timer";

  const btn = document.createElement("button");
  btn.textContent = "Locked";
  btn.disabled = true;

  card.appendChild(title);
  card.appendChild(timer);
  card.appendChild(btn);

  // Only first card gets countdown
  if(index === currentIndex){
    startCountdown(timer, btn, task, index);
  }else{
    timer.textContent = "üîí Complete previous task first";
  }

  return card;
}

function startCountdown(timer, btn, task, index){
  let timeLeft = COUNTDOWN_SECONDS;
  timer.textContent = `‚è≥ Available in ${timeLeft}s`;

  const interval = setInterval(()=>{
    timeLeft--;
    timer.textContent = `‚è≥ Available in ${timeLeft}s`;
    if(timeLeft <= 0){
      clearInterval(interval);
      timer.textContent = "‚úÖ Click to continue";
      btn.textContent = "Go to Link";
      btn.disabled = false;
    }
  },1000);

  btn.onclick = ()=>{
    const token = generateToken();

    const url = new URL(BLOG_VERIFY_PAGE, window.location.origin);
    url.searchParams.set("token", token);
    url.searchParams.set("redirect", task.link);

    window.open(url.toString(), "_blank");

    btn.disabled = true;
    btn.textContent = "Opened";

    // Activate next card
    currentIndex++;
    activateNextCard();
  };
}

function activateNextCard(){
  const cards = document.querySelectorAll(".card");
  if(currentIndex < cards.length){
    const card = cards[currentIndex];
    const timer = card.querySelector(".timer");
    const btn = card.querySelector("button");
    const taskLink = card.getAttribute("data-link");

    startCountdown(timer, btn, {
      link: taskLink
    }, currentIndex);
  }
}

(async ()=>{
  const tasks = await loadTasks();
  const container = document.getElementById("tasks");

  tasks.slice(0,20).forEach((task, index)=>{
    const card = createCard(task, index);
    card.setAttribute("data-link", task.link);
    container.appendChild(card);
  });
})();
</script>

</body>
</html>